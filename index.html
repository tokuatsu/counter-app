<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>カウントボード</title>

<style>
:root{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;
}
html,body{touch-action:manipulation;}
body{margin:0;padding:16px;background:#f4f6f9;}
h1{font-size:20px;margin:0 0 14px;font-weight:900;}

.grid{display:grid;gap:14px;}

.card{
  background:#fff;
  padding:14px 14px 14px 22px;
  border-radius:14px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
  border:1px solid #e9eef6;
  position:relative;
  overflow:hidden;
}

/* ===== 見た目10px / 判定24px ===== */
.color-strip{
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:24px;               /* 判定エリア広く */
  background:transparent;
  -webkit-user-select:none;
  user-select:none;
  -webkit-touch-callout:none;
  touch-action:none;
}

/* 見た目部分 */
.color-strip::before{
  content:"";
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:10px;               /* 見た目は10px */
  background:var(--accent,#A5B4FC);
}
.color-strip:active::before{
  filter:brightness(0.9);
}

.row{display:flex;justify-content:space-between;align-items:center;margin-top:10px;}
.btn{width:56px;height:48px;border:0;border-radius:12px;font-size:24px;font-weight:900;}
.btn.plus{background:var(--accent);color:#111;}
.btn.minus{background:#e5eaf2;}
.value{font-size:30px;font-weight:900;}

.modal-backdrop{
  position:fixed;inset:0;background:rgba(0,0,0,0.35);
  display:none;align-items:flex-end;justify-content:center;
  padding:12px;z-index:9999;
}
.modal{
  width:min(520px,100%);
  background:#fff;border-radius:16px;
  box-shadow:0 12px 40px rgba(0,0,0,0.25);
}
.palette{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:16px;}
.color-btn{height:46px;border-radius:12px;border:1px solid #eee;}
</style>
</head>

<body>
<h1>カウントボード</h1>
<div class="grid" id="grid"></div>

<div class="modal-backdrop" id="modal">
  <div class="modal">
    <div class="palette" id="palette"></div>
  </div>
</div>

<script>
const STORAGE_KEY="count_board_v8_stable_longpress";

const ACCENTS=[
  "#A5B4FC","#93C5FD","#67E8F9","#99F6E4",
  "#86EFAC","#BEF264","#FDE68A","#FED7AA",
  "#FECACA","#FDBA74","#FBCFE8","#F9A8D4",
  "#DDD6FE","#C4B5FD","#BAE6FD","#BBF7D0"
];

let groups=[];

function makeId(){
  return "g_"+Date.now().toString(36)+"_"+Math.random().toString(36).slice(2,8);
}

function defaultGroups(){
  return[
    {id:makeId(),name:"グループ1",value:0,accent:ACCENTS[0]},
    {id:makeId(),name:"グループ2",value:0,accent:ACCENTS[1]},
    {id:makeId(),name:"グループ3",value:0,accent:ACCENTS[2]},
    {id:makeId(),name:"グループ4",value:0,accent:ACCENTS[3]}
  ];
}

function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(groups));}
function load(){
  const raw=localStorage.getItem(STORAGE_KEY);
  if(!raw){groups=defaultGroups();save();return;}
  try{groups=JSON.parse(raw);}catch{groups=defaultGroups();}
}

const grid=document.getElementById("grid");
const modal=document.getElementById("modal");
const palette=document.getElementById("palette");

function render(){
  grid.innerHTML="";
  groups.forEach(g=>{
    const card=document.createElement("div");
    card.className="card";
    card.dataset.id=g.id;
    card.style.setProperty("--accent",g.accent);

    card.innerHTML=`
      <div class="color-strip"></div>
      <div class="row">
        <div>
          <button class="btn minus">−</button>
          <button class="btn plus">＋</button>
        </div>
        <div class="value">${g.value}</div>
      </div>
    `;

    // ===== 長押しは strip に直接付ける =====
    const strip=card.querySelector(".color-strip");
    let timer=null;

    strip.addEventListener("touchstart",e=>{
      e.preventDefault();
      timer=setTimeout(()=>{
        openColorModal(g.id);
      },600);
    },{passive:false});

    strip.addEventListener("touchend",()=>clearTimeout(timer));
    strip.addEventListener("touchmove",()=>clearTimeout(timer));

    // ボタン処理
    card.querySelector(".plus").onclick=()=>{
      g.value++; save(); render();
    };
    card.querySelector(".minus").onclick=()=>{
      g.value=Math.max(0,g.value-1); save(); render();
    };

    grid.appendChild(card);
  });
}

function openColorModal(id){
  const g=groups.find(x=>x.id===id);
  if(!g)return;
  palette.innerHTML="";
  ACCENTS.forEach(color=>{
    const b=document.createElement("button");
    b.className="color-btn";
    b.style.background=color;
    b.onclick=()=>{
      g.accent=color;
      save(); render();
      modal.style.display="none";
    };
    palette.appendChild(b);
  });
  modal.style.display="flex";
}

modal.onclick=e=>{
  if(e.target===modal) modal.style.display="none";
};

load();
render();
</script>
</body>
</html>
